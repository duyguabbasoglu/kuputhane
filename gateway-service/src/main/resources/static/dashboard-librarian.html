<!-- dashboard-librarian.html -->
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <title>Librarian Paneli</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&family=Just+Another+Hand&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="style.css" />
    <style>
        :root {
            --purple: #3b2f5c;
            --gold: #e5c07b;
            --bg-dark: #3b2f5c;
            --bg-light: #2c2c3e;
            --white: #ffffff;
        }
        main { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 2rem; padding: 2rem; background-color: #f4f1de; font-family: 'Roboto', sans-serif; }
        section { background-color: var(--bg-light); border: 1px solid var(--purple); border-radius: 1rem; padding: 1.5rem; box-shadow: 0 0 12px rgba(0,0,0,0.4); color: var(--white); }
        section h2 { color: var(--gold); margin-bottom: 1rem; font-size: 1.3rem; }
        ul { list-style: none; padding: 0; margin-top: 0.5rem; }
        li { margin-bottom: 0.5rem; }
        button, input { padding: 0.5rem 1rem; margin-top: 0.5rem; border: none; border-radius: 0.5rem; font-size: 1rem; }
        button { background-color: var(--gold); color: black; cursor: pointer; transition: background-color 0.3s ease; }
        button:hover { background-color: #d4aa00; }
        input.form-input { width: 100%; box-sizing: border-box; margin-bottom: 0.5rem; }
        footer { background-color: var(--bg-dark); color: var(--gold); text-align: center; padding: 1rem; }
    </style>
</head>
<body>
<header>
    <div class="logo-container" onclick="window.location.href='index.html'">
        <img src="/img/logo.png" class="logo-img" />
        <span class="logo-text">KÃ¼pÃ¼thanem</span>
    </div>
    <nav>
        <a href="index-old.html">Ana Sayfa</a>
        <a href="#" onclick="goToDashboard()">HesabÄ±m</a>
        <a href="login-register.html" onclick="logout()">Ã‡Ä±kÄ±ÅŸ</a>
    </nav>
</header>
<main>
    <section>
        <h2>ðŸ‘¤ KullanÄ±cÄ± Bilgileri</h2>
        <p>Ad Soyad: <strong id="userFullName">-</strong></p>
        <p>Email: <strong id="userEmail">-</strong></p>
        <p>Rol: <strong id="userRole">-</strong></p>
    </section>
    <section>
        <h2>âŒ› Geciken Kitaplar</h2>
        <button onclick="loadLateBooks()">Yenile</button>
        <ul id="lateBooks"></ul>
    </section>
    <section id="permission-lend-book">
        <h2>ðŸ“– Kitap Ã–dÃ¼nÃ§ Ver</h2>
        <input type="number" id="bookId" placeholder="Kitap ID" class="form-input" />
        <button onclick="lendBook()">Ã–dÃ¼nÃ§ Ver</button>
    </section>
    <section id="permission-add-book">
        <h2>âž• Yeni Kitap Ekle</h2>
        <input type="text" id="newBookTitle" placeholder="Kitap AdÄ±" class="form-input" />
        <input type="text" id="newBookAuthor" placeholder="Yazar" class="form-input" />
        <button onclick="addNewBook()">Ekle</button>
    </section>
    <section>
        <h2>ðŸ“Š Ä°statistikler</h2>
        <ul><li>Toplam Kitap: <strong>1520</strong></li><li>Aktif KullanÄ±cÄ±: <strong>430</strong></li><li>Geciken Kitap: <strong>14</strong></li></ul>
    </section>
    <section>
        <h2>ðŸ”” Bildirimler</h2>
        <ul><li>YÃ¼kleniyor...</li></ul>
    </section>
</main>
<footer>
    <p>Â© 2025 KÃ¼tÃ¼phane YÃ¶netim Sistemi</p>
</footer>
<script>
    let userPermissionIds = [];
    function checkPermission(permissionToCheckId, elementIdToShowOrHide) {
        fetch(`http://localhost:8083/api/permissions/check/user?permissionId=${permissionToCheckId}`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(userPermissionIds)
        })
            .then(res => res.json())
            .then(hasAccess => {
                const el = document.getElementById(elementIdToShowOrHide);
                if (!hasAccess && el) el.style.display = "none";
            });
    }

    document.addEventListener("DOMContentLoaded", () => {
        const userJson = localStorage.getItem("loggedInUser");
        const user = JSON.parse(userJson);
        document.getElementById("userFullName").textContent = `${user.firstName} ${user.lastName}`;
        document.getElementById("userEmail").textContent = user.email;
        document.getElementById("userRole").textContent = user.role;

        fetch(`http://localhost:8081/api/users/${user.id}/permissions`)
            .then(res => res.json())
            .then(data => {
                userPermissionIds = data;
                checkPermission(5, "permission-add-book");
                checkPermission(7, "permission-lend-book");
            });
    });
</script>
</body>
</html>